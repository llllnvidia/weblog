{% for post in posts if post %}
    <div class="panel panel-default">
        <div class="panel-body">
            <a href="{{ url_for('main.user', username=post.author.username) }}">
            <h3>{{ post.author.username }}</h3>
            </a>
            {% if post.is_article %}
            <hr/>
            <span class="label label-success">Last edit : {{ moment(post.last_edit).fromNow() }}</span>
            {% endif %}
            <span class="label label-info">Create : {{ moment(post.timestamp).format('LL') }}</span>
            <div class="post-body">
                {% if post.title %}
                    <h3>{{ post.title }}</h3>
                {% endif %}
                {% if post.is_article %}
                    {% if post.comments.count() > 20 %}
                        <a class="label label-danger" style= "margin-right:4px" href="{{ url_for('main.article',id=post.id) }}#comments">
                            {{ post.comments.count() }} Comments
                        </a>
                    {% elif post.comments.count() > 10 %}
                        <a class="label label-warning" style= "margin-right:4px" href="{{ url_for('main.article',id=post.id) }}#comments">
                            {{ post.comments.count() }} Comments
                        </a>
                    {% elif post.comments.count() > 1 %}
                        <a class="label label-info" style= "margin-right:4px" href="{{ url_for('main.article',id=post.id) }}#comments">
                            {{ post.comments.count() }} Comments
                        </a>
                    {% elif post.comments.count() == 1 %}
                        <a class="label label-info" style= "margin-right:4px" href="{{ url_for('main.article',id=post.id) }}#comments">
                            Comment
                        </a>
                    {% else %}
                        <a class="label label-default" style= "margin-right:4px" href="{{ url_for('main.article',id=post.id) }}#comments">
                            none
                        </a>
                {% endif %}
                {% if post.category %}|
                    <span class="label label-primary" style= "margin-right:4px">
                        {{ post.category.name }}
                    </span>
                {% endif %}|
                {% for tag in post.tags %}
                    <span class="label label-info" style= "margin-right:4px">
                        {{ tag.content }}
                    </span>
                {% else %}
                    <span class="label label-default" style= "margin-right:4px">
                        无标签
                    </span>
                {% endfor %}
                {% endif %}
                <hr/>
                {% if request.endpoint == 'main.article' or not post.is_article or not post.summary %}
                    {% if post.body_html %}
                        {{ post.body_html | safe }}
                    {% else %}
                        {{ post.body }}
                    {% endif %}
                {% else %}
                    {% if post.summary_html %}
                        {{ post.summary_html | safe }}
                    {% else %}
                        {{ post.summary }}
                    {% endif %}
                    {% if post.is_article %}<p align="center"><i>略。。。</i></p>{% endif %}
                {% endif %}
            </div>
        </div>                 
        <div class="panel-footer">
            <div class="btn-group">
                {% if post.is_article %}
                    {% if current_user == post.author %}
                        <a type="button" class="btn btn-warning" href="{{ url_for('main.edit_article',id=post.id) }}">
                            修改
                        </a>
                    {% elif current_user.is_moderator() %}
                        <a type="button" class="btn btn-danger" href="{{ url_for('main.edit_article',id=post.id) }}">
                            修改[Admin]
                        </a>
                    {% endif %}
                    {% if request.endpoint != 'main.article' %}
                    <a type="button" class="btn btn-default" href="{{ url_for('main.article',id=post.id) }}">
                        详情
                    </a>
                    {% endif %}
                {% else %}
                    {% if current_user == post.author %}
                        <a type="button" class="btn btn-default btn-warning" href="{{ url_for('main.edit_talk',id=post.id) }}">
                            修改
                        </a>
                    {% elif current_user.is_moderator() %}
                        <a type="button" class="btn btn-danger" href="{{ url_for('main.edit_talk',id=post.id) }}">
                            修改[Admin]
                        </a>
                    {% endif  %}
                {% endif %}                  
            </div>
        </div>
    </div>
{% else %}
    无文章
{% endfor %}

